doctype html
html(lang="en")
  head
    meta(charset="utf-8")
    meta(name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no")
    title= title || "Get Sober Spokane"
    meta(name="description" content=description || "Recovery support community in Spokane, WA")
    
    // Bootstrap Icons
    link(href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet")
    // Google fonts
    link(href="https://fonts.googleapis.com/css?family=Merriweather+Sans:400,700" rel="stylesheet")
    link(href="https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic" rel="stylesheet" type="text/css")
    // Core theme CSS (includes Bootstrap)
    link(href="/get-sober-spokane/css/styles.css" rel="stylesheet")
    
    style.
      /* Fix navigation text visibility */
      .navbar.navbar-light .navbar-nav .nav-link {
        color: #333 !important;
        font-weight: 500;
      }
      
      .navbar.navbar-light .navbar-nav .nav-link:hover {
        color: #007bff !important;
      }
      
      .navbar.navbar-light .navbar-brand {
        color: #333 !important;
        font-weight: 600;
      }
      
      .navbar.navbar-light .navbar-brand:hover {
        color: #007bff !important;
      }
      
      /* Ensure navbar has proper background */
      .navbar.navbar-light {
        background-color: rgba(255, 255, 255, 0.95) !important;
        backdrop-filter: blur(10px);
      }
      
      /* Dropdown styling */
      .dropdown-menu {
        border: none;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        border-radius: 8px;
        padding: 0.5rem 0;
        margin-top: 0.5rem;
        min-width: 200px;
      }
      
      .dropdown-item {
        padding: 0.75rem 1.5rem;
        font-weight: 500;
        color: #333;
        transition: all 0.2s ease;
      }
      
      .dropdown-item:hover {
        background-color: #f8f9fa;
        color: #007bff;
        transform: translateX(3px);
      }
      
      .dropdown-divider {
        margin: 0.25rem 0;
        border-color: #e9ecef;
      }
      
      /* Navbar centering */
      .navbar-nav {
        justify-content: center;
        flex: 1;
      }
      
      .navbar-brand {
        flex-shrink: 0;
      }
      
      /* Responsive adjustments */
      @media (max-width: 991.98px) {
        .navbar-nav {
          justify-content: flex-start;
        }
      }
    
    block head

  body#page-top
    // Navigation
    nav.navbar.navbar-expand-lg.navbar-light.fixed-top.py-3#mainNav
      .container.px-4.px-lg-5
        a.navbar-brand.d-flex.align-items-center(href="/get-sober-spokane/")
          img.logo(src="/get-sober-spokane/assets/img/logo.png" alt="Get Sober Spokane Logo")
          span.ms-2 Get Sober Spokane
        button.navbar-toggler.navbar-toggler-right(type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation")
          span.navbar-toggler-icon
        .collapse.navbar-collapse#navbarResponsive
          ul.navbar-nav.ms-auto.my-2.my-lg-0
            li.nav-item
              a.nav-link(href="/get-sober-spokane/") Home
            li.nav-item.dropdown
              a.nav-link.dropdown-toggle(href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false") Resources
              ul.dropdown-menu
                li
                  a.dropdown-item(href="/get-sober-spokane/resource-directory.html")
                    i.bi.bi-list-ul.me-2
                    | Resource Directory
                li
                  a.dropdown-item(href="/get-sober-spokane/addiction-treatments-support.html")
                    i.bi.bi-heart-pulse.me-2
                    | Treatment & Support
                li
                  a.dropdown-item(href="/get-sober-spokane/medical-mental-health.html")
                    i.bi.bi-stethoscope.me-2
                    | Medical & Mental Health
                li
                  a.dropdown-item(href="/get-sober-spokane/shelter-housing.html")
                    i.bi.bi-house.me-2
                    | Shelter & Housing
                li
                  a.dropdown-item(href="/get-sober-spokane/food-basic-needs.html")
                    i.bi.bi-bag-heart.me-2
                    | Food & Basic Needs
                li
                  a.dropdown-item(href="/get-sober-spokane/employment-skills.html")
                    i.bi.bi-briefcase.me-2
                    | Employment & Skills
                li
                  a.dropdown-item(href="/get-sober-spokane/community-engagement-sober-activities.html")
                    i.bi.bi-people.me-2
                    | Sober Activities
                li
                  a.dropdown-item(href="/get-sober-spokane/map.html")
                    i.bi.bi-geo-alt.me-2
                    | Recovery Map
            li.nav-item
              a.nav-link(href="/get-sober-spokane/donations.html") Donate
            li.nav-item
              a.nav-link(href="/get-sober-spokane/dashboard.html") Dashboard
            li.nav-item
              a.nav-link(href="/get-sober-spokane/#contact") Contact
            // Auth navigation
            li.nav-item(data-auth="guest")
              a.nav-link#navbarLogin(href="/get-sober-spokane/auth/login.html") Sign In
            li.nav-item(data-auth="required" style="display:none;")
              a.nav-link#navbarLogout(href="#") Sign Out

    block content

    // Footer
    footer.bg-light.py-5
      .container.px-4.px-lg-5
        a(href="/get-sober-spokane/")
          img.footer-logo(src="/get-sober-spokane/assets/img/logo.png" alt="Get Sober Spokane Logo")
        .small.text-center.text-muted
          | Copyright Â© 2025 - Get Sober Spokane
          br
          a(href="/get-sober-spokane/privacy-policy.html") Privacy Policy
          |  |
          a(href="/get-sober-spokane/terms-of-service.html") Terms of Service

    // Bootstrap core JS
    script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js")
    // Core theme JS
    // Supabase and Auth Scripts (UMD build for window.supabase)
    // Inject environment values for frontend consumption
    script(src="/get-sober-spokane/env.js")
    script(src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js")
    script(src="/get-sober-spokane/js/config.js")
    script(src="/get-sober-spokane/js/auth.js")
    
    // Initialize Bootstrap dropdowns for navigation
    script.
      document.addEventListener('DOMContentLoaded', function() {
        // Initialize all dropdowns
        const dropdownElementList = document.querySelectorAll('.dropdown-toggle');
        const dropdownList = [...dropdownElementList].map(dropdownToggleEl => new bootstrap.Dropdown(dropdownToggleEl));
        
        // Hide Sign In link on auth pages only
        const hideLoginOnPages = /\/(auth\/(login|signup|reset)\.html)$/.test(window.location.pathname);
        if (hideLoginOnPages) {
          const loginNavItem = document.getElementById('navbarLogin');
          if (loginNavItem && loginNavItem.parentElement) {
            loginNavItem.parentElement.style.display = 'none';
          }
        }

        // Ensure dropdowns work on mobile
        const navbarToggler = document.querySelector('.navbar-toggler');
        if (navbarToggler) {
          navbarToggler.addEventListener('click', function() {
            // Re-initialize dropdowns after navbar collapse
            setTimeout(() => {
              const mobileDropdowns = document.querySelectorAll('.dropdown-toggle');
              mobileDropdowns.forEach(dropdown => {
                if (!dropdown._dropdown) {
                  dropdown._dropdown = new bootstrap.Dropdown(dropdown);
                }
              });
            }, 100);
          });
        }

        // Navbar logout handler
        const navbarLogout = document.getElementById('navbarLogout');
        if (navbarLogout) {
          navbarLogout.addEventListener('click', async function(e) {
            e.preventDefault();
            try {
              if (window.authManager && typeof window.authManager.signOut === 'function') {
                await window.authManager.signOut();
              }
              // Also clear server session
              try {
                await fetch('/api/auth/logout', { method: 'POST' });
              } catch (err) {
                console.warn('Server session logout failed or not available', err);
              }
            } finally {
              window.location.href = '/auth/login.html?logout=true';
            }
          });
        }
      });
    
    block scripts 